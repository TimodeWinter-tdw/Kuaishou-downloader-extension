let video=document.getElementsByClassName("work-card-thumbnail"),index=0;function hourDiff(e,i){return Math.floor(Math.abs(e.getTime()-i.getTime())/36e5)}function dayDiff(e,i){return Math.abs((e.getTime()-i.getTime())/864e5)}function weekDiff(e,i){return Math.floor(dayDiff(e,i)/7)}function monthDiff(e,i){var t;return t=12*(e.getFullYear()-i.getFullYear()),t-=i.getMonth()+1,(t+=e.getMonth())<=0?0:t}function yearDiff(e,i){return e.getFullYear()-i.getFullYear()}function log(e){console.log(e)}function sleepFor(e){let i=(new Date).getTime();for(;(new Date).getTime()<i+e;);}function download(e){log("Download function called.");let i=index+1+"___"+(new Date).getTime()+".mp4";chrome.runtime.sendMessage({url:e,filename:i},function(e){console.log(e.message)})}fireEvent=function(e,i){if(document.createEventObject){var t=document.createEventObject();return e.fireEvent("on"+i,t)}return(t=document.createEvent("HTMLEvents")).initEvent(i,!0,!0),!e.dispatchEvent(t)},jQuery.fn.fclick=function(){$(this).each(function(){fireEvent(this,"click")})},log("Total videos in the list: "+video.length);let interval1=setInterval(()=>{setTimeout(function(){log("Process for video on position "+(index+1)+" has started.");let e=$(".work-card-info-time").eq(index).text(),i=e.split("小时前"),t=e.split("天前"),n=e.split("周前"),o=e.split("月前"),l=e.split("年前");if(void 0!==i[1]){let e=hourDiff(new Date,new Date(startDate)),t=hourDiff(new Date,new Date(endDate));if(i[0]<=e&&i[0]>=t){if($(".work-card-thumbnail").eq(index).fclick(),document.getElementsByClassName("feed-list-item")[0])if(document.getElementsByClassName("viewer-container-img").length>0)log("Item in card on position "+(index+1)+" is apparently a video.");else{log("Sleeping for 2500 milliseconds before video URL is gathered for video on position: "+(index+1)),sleepFor(2500);let e=document.getElementsByTagName("video")[0].currentSrc;log("Video URL for video on position "+(index+1)+" is: "+e),download(e)}$(".close").fclick()}}else if(void 0!==t[1]){let e=dayDiff(new Date,new Date(startDate)),i=dayDiff(new Date,new Date(endDate));if(t[0]<=e&&t[0]>=i){if($(".work-card-thumbnail").eq(index).fclick(),document.getElementsByClassName("feed-list-item")[0])if(document.getElementsByClassName("viewer-container-img").length>0)log("Item in card on position "+(index+1)+" is apparently a video.");else{log("Sleeping for 2500 milliseconds before video URL is gathered for video on position: "+(index+1)),sleepFor(2500);let e=document.getElementsByTagName("video")[0].currentSrc;log("Video URL for video on position "+(index+1)+" is: "+e),download(e)}$(".close").fclick()}}else if(void 0!==n[1]){let e=weekDiff(new Date,new Date(startDate)),i=weekDiff(new Date,new Date(endDate));if(n[0]<=e&&n[0]>=i){if($(".work-card-thumbnail").eq(index).fclick(),document.getElementsByClassName("feed-list-item")[0])if(document.getElementsByClassName("viewer-container-img").length>0)log("Item in card on position "+(index+1)+" is apparently a video.");else{log("Sleeping for 2500 milliseconds before video URL is gathered for video on position: "+(index+1)),sleepFor(2500);let e=document.getElementsByTagName("video")[0].currentSrc;log("Video URL for video on position "+(index+1)+" is: "+e),download(e)}$(".close").fclick()}}else if(void 0!==o[1]){let e=monthDiff(new Date,new Date(startDate)),i=monthDiff(new Date,new Date(endDate));if(o[0]<=e&&o[0]>=i){if($(".work-card-thumbnail").eq(index).fclick(),document.getElementsByClassName("feed-list-item")[0])if(document.getElementsByClassName("viewer-container-img").length>0)log("Item in card on position "+(index+1)+" is apparently a video.");else{log("Sleeping for 2500 milliseconds before video URL is gathered for video on position: "+(index+1)),sleepFor(2500);let e=document.getElementsByTagName("video")[0].currentSrc;log("Video URL for video on position "+(index+1)+" is: "+e),download(e)}$(".close").fclick()}}else if(void 0!==l[1]){let e=yearDiff(new Date,new Date(startDate)),i=yearDiff(new Date,new Date(endDate));if(l[0]<=e&&l[0]>=i){if($(".work-card-thumbnail").eq(index).fclick(),document.getElementsByClassName("feed-list-item")[0])if(document.getElementsByClassName("viewer-container-img").length>0)log("Item in card on position "+(index+1)+" is apparently a video.");else{log("Sleeping for 2500 milliseconds before video URL is gathered for video on position: "+(index+1)),sleepFor(2500);let e=document.getElementsByTagName("video")[0].currentSrc;log("Video URL for video on position "+(index+1)+" is: "+e),download(e)}$(".close").fclick()}}log("Loops for video on position "+(index+1)+" have ended."),index!==video.length?(log("Index "+index+"is shorter than the video length of "+video.length+"so the index will be increased."),log("New index: "+ ++index)):clearInterval(interval1)},500)},2e4);
